# Deformation Transfer
This is an implementation of Deformation Transfer algorithm in ANSI C, which
could transfer the deformation of one triangle mesh to another. It is based on
https://github.com/Golevka/deformation-transfer.

This will compute the deformations between pose_0.obj, pose_1.obj, ..., 
pose_19.obj and transfer the deformations onto emily mesh and obtain 
different expressions.

# Dependency
1. CHOLMOD (http://www.cise.ufl.edu/research/sparse/cholmod/)
2. UMFPACK (http://www.cise.ufl.edu/research/sparse/umfpack/)

# Compile
1. `cd external/SuiteSparse && make`
2. `cd ../../`
3. `make`
4. if occur error: cannot link the "libcholmod.so.0.3", please `sudo cp external/SuiteSparse/lib/* /usr/lib/x86_64-linux-gnu/`

# Usage
1. Correspondence phase:
`./../bin/corres_resolve horse_ref.obj camel_ref.obj horse_camel.cons [1:10:50]`

* horse_ref.obj:     source reference mesh
* camel_ref.obj:     target reference mesh
* horse_camel.cons:  vertex constraints (marker points), user can specify marker points corrstool.
* [1:10:50] :        closest point iteration procedure: weight increase from 1 to 50, increment step: 10.

* out.obj:       deformed source mesh
* out.tricorrs:  triangle correspondence resolved by corres_resolve

2. Deformation transfer phase:
`./../bin/dtrans horse_ref.obj camel_ref.obj out.tricorrs horse-*.obj`

3. Generated camel poses are saved as out_##.obj. There should be 9 output files generated by dtrans, you can inspect'em using corrstool, or modelviz.
`./../bin/corrstool horse-01.obj out_0.obj`


# Corrstool标注工具用法
Correspondence phase: You need to pick up a small set of marker points to
specify the semantic correspondence between the source model and the target
model.

It would open a window showing the source model at the left panel and target model
at the right panel, drag your mouse with left mouse button pressed to view the
model in a different angle (it would change the view angle of the two panels
simutanously), and drag with right mouse button pressed to zoom the view.

`./corrstool [source_model] [target_model]` or `./corrstool horse_ref.obj camel_ref.obj`

* move the cursor to somewhere in the model you want to mark and press =P= to mark this point

* after having specifed marker points on both models, press =A= to "commit" this point pair to correspondence list, 

* if you hit =A= by mistake, just hit =U= (undo) to recover from that.

* you can view models in wired mode by pressing =M=, and strike it again to get back to
solid mode. 

* If you want to switch to another point on the same piece of triangle, 
just hit =C= many times until you get what you want.

* After all marker points has been specified, press =W= to write the
correspondence to a .cons file (default.cons by default).

0. p: Mark this Point
1. a: AppendCurrent加入当前点
2. m: SwitchRenderMode切换渲染模型
3. c: SwitchVertex
4. w: WriteToFile
5. u: Undo

# Reference
1. Robert W. Sumner, Jovan Popović. Deformation Transfer for Triangle Meshes. Siggraph 2004. 
2. http://people.csail.mit.edu/sumner/research/deftransfer/Sumner2004DTF.pdf
3. http://people.csail.mit.edu/sumner/research/deftransfer/ 
